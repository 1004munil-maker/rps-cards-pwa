/* =========================================================
   style.css — Pro Upgrade v3.1 (final-polish)
   01) 右切れ対策 / safe-area / minmax(0,1fr)
   02) タイポ＆配色見直し（軽量リッチ）
   03) 盤面10×2固定・GOAL中央＆小さめ（重複定義を統一）
   04) トークンの重なり/影/ポップ感を改良
   05) ダーク & 省モーション対応
   ========================================================= */

/* ============ 00. Theme Tokens ============ */
:root{
  --bg:#fff5fa;
  --surface:#ffffff;
  --ink:#2e2a2a;
  --muted:#6b6b6b;
  --pink:#ff99c8;
  --pink-2:#ffd1e6;
  --pink-strong:#ff5ca1;
  --blue:#8ecae6;

  --ring:0 0 0 3px rgba(255,153,200,.28);
  --ring-strong:0 0 0 5px rgba(255,153,200,.22);
  --shadow:0 16px 50px rgba(0,0,0,.16);
  --shadow-soft:0 12px 32px rgba(0,0,0,.12);

  --h1: clamp(18px, 2vw + 14px, 22px);
  --small: 12px;
  --press: translateY(1px) scale(.995);
  --card-r: 16px;

  /* Board tokens */
  --token-size: 44%;
  --ol-shift: 10%;
  --ol-shift-goal: 7%;

  /* GOAL ラベル（中央＆少し小さめ） */
  --goal-size: 8px;
  --goal-weight: 900;
  --goal-opacity: .9;
}
@media (max-width: 360px){
  :root{
    --token-size: 42%;
    --ol-shift: 8%;
    --ol-shift-goal: 6%;
    --goal-size: 7px;
  }
}

*{ box-sizing:border-box; -webkit-tap-highlight-color:transparent; }
html,body{
  margin:0; height:100%; width:100%;
  background: radial-gradient(160% 140% at 100% 0%, #fff 0%, #fff6fb 50%, #ffeaf5 100%);
  color:var(--ink);
  font-family:system-ui,-apple-system,"Segoe UI",Roboto,Helvetica,Arial,"Noto Sans JP","Hiragino Kaku Gothic ProN",Meiryo,sans-serif;
  text-rendering:optimizeLegibility;
  -webkit-font-smoothing:antialiased;
}

/* 右切れ対策 */
html,body{ overflow-x:hidden; }
body{ overflow-y:hidden; overscroll-behavior:none; touch-action:manipulation; }
.hidden{ display:none !important; }

/* ============ 01. Viewport Safe Area ============ */
.root9x16{
  position:relative;
  inline-size:min(520px, 100vw);
  block-size:100dvh; min-block-size:100svh;
  margin-inline:auto;
  display:flex; align-items:stretch; justify-content:center;

  padding-top:calc(env(safe-area-inset-top,0px) + 8px);
  padding-bottom:calc(env(safe-area-inset-bottom,0px) + 8px);
  padding-left:max(10px, env(safe-area-inset-left,0px));
  padding-right:max(10px, env(safe-area-inset-right,0px));
}
@supports (width:100svw){ .root9x16{ inline-size:min(520px, 100svw); } }

.wrap{
  width:100%;
  display:grid;
  grid-template-rows:auto 1fr auto;
  gap:10px;
  overflow-x:visible;
  min-width:0;
}

/* ============ 02. Header / Brand ============ */
.brand{ display:flex; align-items:center; justify-content:space-between; }
.brand__left{ display:flex; align-items:center; gap:10px; }
.brand__icon{
  font-size:28px;
  filter:drop-shadow(0 10px 20px rgba(0,0,0,.18));
  transform: translateZ(0);
}
.brand__text h1{ font-size:var(--h1); margin:0 0 2px; letter-spacing:.2px; font-weight:800; }
.brand__text .brand__sub{ font-size:12px; margin:0; color:var(--muted); }

/* Help FAB */
.help-fab{
  width:36px; height:36px; border-radius:999px; border:none;
  background:linear-gradient(180deg,#fff,#fff7fb);
  box-shadow:0 10px 26px rgba(0,0,0,.14), inset 0 0 0 2px #ffe8f3;
  font-weight:900; color:var(--pink-strong); cursor:pointer;
  transition: transform .06s ease, box-shadow .2s ease;
}
.help-fab:active{ transform:var(--press); }

/* ============ 03. Card Shell ============ */
.card{
  background:
    radial-gradient(120% 120% at 80% 0%, rgba(255,255,255,.92) 0%, rgba(255,255,255,.65) 60%, rgba(255,255,255,.55) 100%),
    linear-gradient(180deg, #fff, #fff8fb);
  border-radius:var(--card-r);
  padding:12px 14px;
  box-shadow:var(--shadow);
  border:1px solid #ffecf6;
  backdrop-filter:saturate(1.1) blur(2px);
  min-width:0;
}
.row{ display:flex; gap:8px; margin:8px 0; min-width:0; }
.row--space{ justify-content:space-between; align-items:center; }

.players{ display:flex; align-items:center; justify-content:center; gap:8px; margin:8px 0 12px; min-width:0; }
.pill{
  padding:6px 10px; border-radius:999px; font-weight:800; font-size:13px;
  background:#fff; border:2px solid #eee; letter-spacing:.2px;
  box-shadow:0 1px 0 rgba(0,0,0,.04);
}
.pill--me{ border-color:var(--pink); }
.pill--op{ border-color:var(--blue); }
.vs{ font-weight:900; color:#aaa; }

input{
  flex:1; padding:12px 12px;
  border-radius:12px; border:1px solid var(--pink-2); background:#fff;
  outline:none; font-size:15px; min-width:0;
  transition: box-shadow .15s ease, border-color .15s ease;
}
input:focus{ box-shadow:var(--ring); border-color:var(--pink); }

/* Buttons */
button{
  position:relative;
  padding:12px 12px; border:none; border-radius:12px;
  background:var(--pink-2); cursor:pointer; font-weight:800;
  transition: transform .06s ease, box-shadow .2s ease, filter .2s ease;
  min-width:0; overflow:hidden; isolation:isolate;
}
button:active{ transform:var(--press); }
button.primary{ background:linear-gradient(180deg, #ffa7d0, #ff8fbf); color:#fff; box-shadow:0 10px 24px rgba(255,143,191,.34); }
button.warn{ background:linear-gradient(180deg, #ff8a8a, #ff6b6b); color:#fff; box-shadow:0 10px 24px rgba(255,107,107,.30); }
button.ghost{ background:#f6f6f6; }
button:disabled{ opacity:.55; cursor:not-allowed; }
button::after{
  content:""; position:absolute; inset:0; pointer-events:none;
  background:radial-gradient(120px 120px at var(--rx,50%) var(--ry,50%), rgba(255,255,255,.55), transparent 60%);
  opacity:0; transform:scale(.6); transition:opacity .35s ease, transform .35s ease;
}
button:active::after{ opacity:1; transform:scale(1); }
button:active{ --rx:50%; --ry:50%; }

.help{ font-size:var(--small); color:var(--muted); margin:6px 4px 0; }

/* ============ 04. Info Bar ============ */
.infoBar{
  display:flex; justify-content:space-between; align-items:center;
  margin:6px 0 4px; font-size:14px;
  padding:8px 10px;
  background:#fff; border-radius:12px; box-shadow:var(--shadow);
  border:1px solid #ffeaf3;
  min-width:0;
}
.timer b{ font-variant-numeric:tabular-nums; font-feature-settings:"tnum"; }

/* ============ 05. Board 10×2 ============ */
.board{
  width:100%; max-width:100%;
  margin:8px 0;
  display:grid;
  grid-template-columns:repeat(10, minmax(0, 1fr));
  grid-auto-rows:1fr;
  gap:6px;
  margin-inline:auto;
  min-width:0;
}
.cell{
  position:relative;
  background:
    radial-gradient(120% 100% at 100% 0%, #ffffff 0%, #fff5fb 60%, #ffe6f4 100%),
    linear-gradient(180deg, #fff, #fff);
  border-radius:12px;
  aspect-ratio:1 / .6;
  box-shadow:inset 0 0 0 2px #ffe0ef;
  overflow:hidden; min-width:0;
  transition: transform .1s ease, box-shadow .2s ease;
  will-change: transform;
}
.cell:active{ transform:scale(.995); box-shadow:inset 0 0 0 2px #ffd1e6, 0 0 0 3px rgba(255,153,200,.12); }

/* GOAL（中央 & 小さめ / 一意に定義） */
.cell.goal{
  box-shadow:inset 0 0 0 3px var(--pink), 0 0 0 2px rgba(255,153,200,.15);
}
.cell.goal::after{
  content:"GOAL";
  position:absolute;
  top:50%; left:50%;
  transform: translate(-50%, -50%);
  font-size:var(--goal-size);
  font-weight:var(--goal-weight);
  color:var(--pink-strong);
  letter-spacing:.36px;
  opacity:var(--goal-opacity);
  z-index:1;            /* トークン(2)より下 */
  pointer-events:none;
  mix-blend-mode:normal;
}

/* ============ 06. Tokens ============ */
.token{
  position:absolute;
  width:var(--token-size);
  height:var(--token-size);
  top:50%; left:50%;
  transform:translate(-50%, -50%);
  transform-origin:center center;
  border-radius:999px;
  outline:2px solid #fff;
  box-shadow:0 8px 20px rgba(0,0,0,.20);
  animation: tokenPop .18s ease-out;
  z-index:2;
}
@keyframes tokenPop{
  from{ transform:translate(-50%,-50%) scale(.86); opacity:.0; }
  to{   transform:translate(-50%,-50%) scale(1);   opacity:1; }
}
.token.me{ background: radial-gradient(140% 140% at 30% 20%, #ffd1e6 0%, #ff99c8 70%); }
.token.op{ background: radial-gradient(140% 140% at 30% 20%, #cfefff 0%, #8ecae6 70%); }

/* 同マス時の左右オフセット */
.token.overlap-left{  transform:translate(calc(-50% - var(--ol-shift)), -50%); z-index:3; }
.token.overlap-right{ transform:translate(calc(-50% + var(--ol-shift)), -50%); z-index:2; }
/* ゴールは控えめ */
.cell.goal .token.overlap-left{  transform:translate(calc(-50% - var(--ol-shift-goal)), -50%); }
.cell.goal .token.overlap-right{ transform:translate(calc(-50% + var(--ol-shift-goal)), -50%); }

/* ============ 07. Status / Hand ============ */
.status{ display:flex; gap:8px; margin:8px 0; min-width:0; }
.chip{
  background:#fff; border-radius:999px; padding:6px 10px;
  box-shadow:0 1px 0 rgba(0,0,0,.04); font-size:13px; font-weight:800;
  border:2px solid #eee;
}
.chip.me{ border-color:var(--pink); }
.chip.op{ border-color:var(--blue); }

h2.cute{ margin:0 0 6px; font-size:15px; font-weight:900; letter-spacing:.3px; }
.handRow{ display:flex; gap:8px; margin:8px 0; min-width:0; }

.cardBtn{
  flex:1; display:flex; flex-direction:column; align-items:center; gap:4px;
  background:#fff; border:2px solid transparent; border-radius:14px;
  padding:10px 6px; box-shadow:0 10px 24px rgba(0,0,0,.08); min-width:0;
  transition: transform .06s ease, box-shadow .2s ease, border-color .15s ease, filter .2s ease;
  position:relative; overflow:hidden;
}
.cardBtn:active{ transform:var(--press); }
.cardBtn .emoji{ font-size:22px; filter: drop-shadow(0 4px 8px rgba(0,0,0,.08)); }
.cardBtn .label{ font-size:12px; font-weight:800; letter-spacing:.2px; }
.cardBtn .count{ font-size:11px; color:#555; font-variant-numeric:tabular-nums; }
.cardBtn.selected{
  border-color:#ffb3cc;
  box-shadow:0 0 0 4px rgba(255,179,204,.38), var(--shadow-soft);
  filter:saturate(1.05);
}

/* 結果プレビュー */
.reveal.card{
  display:flex; justify-content:space-between; gap:10px;
  margin-top:8px; font-size:14px;
  border:1px solid #ffe8f3;
}

/* ============ 08. Footer & Ads ============ */
.footer{ text-align:center; color:#999; font-size:12px; }
.ad-card{ padding:6px 8px; margin-top:10px; overflow:hidden; }
ins.adsbygoogle{ display:block !important; width:100% !important; max-width:100% !important; box-sizing:border-box !important; }

/* ============ 09. Orientation Guard ============ */
.orientation-guard{
  position:fixed; inset:0; display:none;
  align-items:center; justify-content:center;
  background:rgba(0,0,0,.35); z-index:9999; backdrop-filter:blur(2px);
}
.orientation-guard .og-card{
  background:#fff; border-radius:14px; padding:20px;
  box-shadow:var(--shadow); border:1px solid #ffe5f1;
}
@media (orientation:landscape){ .orientation-guard{ display:flex; } }

/* ============ 10. Help Modal ============ */
.help-modal{
  position:fixed; inset:0; z-index:9998;
  display:grid; place-items:center;
  background:rgba(0,0,0,.45);
  backdrop-filter:blur(2px);
}
.help-modal__card{
  width:min(92%, 520px);
  background:rgba(255,255,255,.9);
  border-radius:16px;
  padding:14px;
  box-shadow:var(--shadow);
  border:1px solid #ffe8f3;
  backdrop-filter:saturate(1.1) blur(4px);
}
.help-modal__head{ display:flex; align-items:center; justify-content:space-between; margin-bottom:4px; }
.help-modal__head h3{ margin:0; font-size:18px; font-weight:900; letter-spacing:.2px; }
.help-close{
  border:none; background:#f7f7f7; border-radius:10px; padding:6px 10px; cursor:pointer;
  box-shadow:0 4px 12px rgba(0,0,0,.08);
}
.help-modal__body{ font-size:14px; color:#444; }
.help-modal__body ol{ margin:8px 0 6px 20px; padding:0; }
.help-modal__body li{ margin:4px 0; }
.help-modal__body .hint{ font-size:12px; color:#777; margin:8px 0 0; }
.help-modal__foot{ display:flex; justify-content:flex-end; gap:8px; margin-top:10px; }

/* ============ 11. Focus Visible ============ */
:focus-visible{
  outline:none;
  box-shadow:var(--ring-strong);
  border-color:#ffb7d3 !important;
}

/* ============ 12. Compact Adjust on Small Phones ============ */
@media (max-width:360px){
  .card{ padding:10px 12px; border-radius:14px; }
  .cell{ border-radius:10px; }
  .cardBtn{ padding:9px 5px; }
  .cardBtn .emoji{ font-size:20px; }
}

/* ============ 13. Dark Mode ============ */
@media (prefers-color-scheme: dark){
  :root{
    --bg:#1b1a1b; --surface:#1f1e1f; --ink:#f2f2f2; --muted:#b8b8b8;
    --shadow:0 16px 50px rgba(0,0,0,.5);
    --goal-opacity:.95;
  }
  html,body{ background: radial-gradient(160% 140% at 100% 0%, #232225 0%, #1c1b1d 50%, #1a191c 100%); }
  .card{ background: linear-gradient(180deg, #242326, #1e1d20); border-color:#3a2b35; }
  .infoBar, .chip, .reveal.card{ background:#242326; border-color:#3a2b35; }
  input{ background:#2a2930; border-color:#3a2b35; color:#f2f2f2; }
  .cell{ background: radial-gradient(120% 100% at 100% 0%, #2a2a30 0%, #27262c 60%, #26252a 100%); box-shadow:inset 0 0 0 2px #3a2b35; }
  .cell.goal{ box-shadow:inset 0 0 0 3px #ff79b4, 0 0 0 2px rgba(255,121,180,.18); }
  .cell.goal::after{ color:#ff93c3; }
}

/* ============ 14. Reduced Motion ============ */
@media (prefers-reduced-motion: reduce){
  *{ animation:none !important; transition:none !important; }
}

/* ============ 15. WebKit Scrollbar Hide ============ */
::-webkit-scrollbar{ display:none; }

/* === Duel Header / Stamp (追加) === */
:root{
  --me-color: #ff99c8;   /* 自分カラー（既存に合わせたピンク系） */
  --op-color: #9bf6ff;   /* 相手カラー（既存ボードの青系に寄せる） */
}

.duelHeader{
  display:grid;
  grid-template-columns: 1fr auto 1fr;
  align-items:center;
  gap:10px;
  margin:10px 0 6px;
}
.duelVS{
  font-weight:900;
  letter-spacing:1px;
  opacity:.75;
}
.duelName{
  position:relative;
  display:inline-flex;
  align-items:center;
  justify-content:center;
  padding:8px 12px;
  min-height:38px;
  border-radius:999px;
  font-weight:800;
  box-shadow:0 4px 12px rgba(0,0,0,.08);
  white-space:nowrap;
}
.duelName--me{ background:var(--me-color); color:#000; justify-self:start; }
.duelName--op{ background:var(--op-color); color:#000; justify-self:end; }

.duelName .speech{
  position:absolute;
  bottom:100%;
  left:50%;
  transform:translateX(-50%) translateY(-8px) scale(.96);
  background:#fff;
  border-radius:12px;
  padding:6px 10px;
  box-shadow:0 6px 18px rgba(0,0,0,.15);
  font-size:20px;
  opacity:0; pointer-events:none;
  transition:opacity .15s ease, transform .15s ease;
}
.duelName .speech.show{
  opacity:1;
  transform:translateX(-50%) translateY(-12px) scale(1);
}

/* スタンプ選択 */
.stamp-picker{
  position:fixed;
  right:12px; bottom:96px; /* 手札の上あたり */
  background:#fff;
  border-radius:14px;
  box-shadow:0 12px 28px rgba(0,0,0,.22);
  padding:10px;
  z-index:9000;
}
.stamp-picker.hidden{ display:none; }
.stamp-grid{
  display:grid;
  grid-template-columns: repeat(4, 44px);
  gap:8px;
}
.stamp{
  width:44px; height:44px;
  border-radius:10px;
  border:none;
  font-size:24px;
  background:#f6f7fb;
  box-shadow:0 1px 0 rgba(0,0,0,.04) inset;
  cursor:pointer;
}
.stamp:active{ transform:scale(.96); }

@media (max-width: 360px){
  .stamp-grid{ grid-template-columns: repeat(4, 40px); }
  .stamp{ width:40px; height:40px; font-size:22px; }
}
