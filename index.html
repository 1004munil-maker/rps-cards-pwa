<!doctype html>
<html lang="ja">
<head>
  <!-- [H1] 基本メタ -->
  <meta charset="utf-8" />
  <meta name="viewport"
        content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no, viewport-fit=cover">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="theme-color" content="#ff99c8">
  <title>じゃんけんカード・レース</title>

  <!-- [H2] PWA -->
  <link rel="manifest" href="manifest.json">
  <link rel="icon" href="icons/icon-192.png">
  <link rel="apple-touch-icon" href="icons/icon-192.png">

  <!-- [H3] Google AdSense（オート広告） -->
  <script async
    src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-3891016340964160"
    crossorigin="anonymous"></script>

  <!-- [H4] CSS -->
  <link rel="stylesheet" href="style.css" />

</head>
<body>
  <!-- [B1] 縦固定(9:16)の表示枠 -->
  <div id="root9x16" class="root9x16">
    <main class="wrap">
      <!-- [B2] ブランド／ヘッダ -->
      <header class="brand">
        <div class="brand__left">
          <div class="brand__icon">🧸</div>
          <div class="brand__text">
            <h1>じゃんけんカード・レース</h1>
            <p class="brand__sub">20マスでゴールを目指すよ（最低8ラウンド）</p>
          </div>
        </div>
        <button id="helpBtn" class="help-fab" aria-label="あそびかた">?</button>
      </header>

      <!-- [B4] 参加カード -->
      <section id="auth" class="card">
        <div class="row">
          <input id="playerName" placeholder="名前（例：じゃがいも）" maxlength="20" autocomplete="off" />
        </div>
        <div class="row">
          <button id="btnCreate" class="primary">🎉 部屋を作る</button>
        </div>
        <div class="row">
          <input id="joinId" placeholder="部屋ID（6文字）" maxlength="6" />
          <button id="btnJoin">入室</button>
        </div>
        <p class="help">友だちに部屋IDを共有してね！</p>

    <div class="row">
  <button id="btnRandom" class="primary">🎲 ランダム対戦 Beta</button>
</div>
      </section>

      <!-- [B5] ロビー -->
      <section id="lobby" class="card hidden">
        <p class="row row--space">
          <span>部屋ID: <b id="roomIdLabel"></b></span>
          <button id="btnCopy" class="ghost">コピー</button>
        </p>
        <p class="players">
          <span class="pill pill--me" id="p1Label">-</span>
          <span class="vs">VS</span>
          <span class="pill pill--op" id="p2Label">-</span>
        </p>
        <div class="row">
          <button id="btnStart" class="primary">▶ Ready</button>
          <button id="btnLeave" class="warn">退出</button>
        </div>
      </section>

      <!-- [B6] ゲーム -->
      <section id="game" class="hidden">
        <div class="infoBar">
          <div>ラウンド <b id="roundNo">-</b> / <span id="minRounds">8</span>+</div>
          <div class="timer">⏱ <b id="timer">10</b>s</div>
          <div>差：<b id="diff">0</b>マス</div>
        </div>

        <!-- ★ 10×2 グリッド -->
        <div class="board board--10x2" id="board"></div>

        <div class="status">
          <div class="chip me">あなた：<b id="mePos">0</b>/<span id="boardSizeLabel">20</span></div>
          <div class="chip op">相　手：<b id="opPos">0</b>/<span id="boardSizeLabel2">20</span></div>
        </div>

        <!-- 手札 -->
        <section class="hand card">
          <h2 class="cute">あなたのカード</h2>
          <div class="handRow">
            <button class="cardBtn" data-card="G">
              <span class="emoji">✊</span>
              <span class="label">グー</span>
              <span class="count" id="cntG">×4</span>
            </button>
            <button class="cardBtn" data-card="C">
              <span class="emoji">✌️</span>
              <span class="label">チョキ</span>
              <span class="count" id="cntC">×4</span>
            </button>
            <button class="cardBtn" data-card="P">
              <span class="emoji">🫲</span>
              <span class="label">パー</span>
              <span class="count" id="cntP">×4</span>
            </button>
          </div>
          <div class="handRow special">
            <button class="cardBtn" data-card="WIN" title="どんな手にも勝つ（+4）※バリアに負け">
              <span class="emoji">👑</span>
              <span class="label">必勝</span>
              <span class="count" id="cntWIN">×1</span>
            </button>
            <button class="cardBtn" data-card="SWAP" title="差が8未満なら位置を交換 ※バリアに負け">
              <span class="emoji">🔁</span>
              <span class="label">位置交換</span>
              <span class="count" id="cntSWAP">×1</span>
            </button>
            <button class="cardBtn" data-card="BARRIER" title="相手の必勝/位置交換を防ぐ。通常手相手だと自分-1のペナルティ">
              <span class="emoji">🛡️</span>
              <span class="label">バリア</span>
              <span class="count" id="cntBARRIER">×1</span>
            </button>
          </div>
          <div class="row">
            <button id="btnPlay" class="primary" disabled>このカードを出す</button>
            <button id="btnClear" class="ghost">選択解除</button>

          </div>
          <p id="stateMsg" class="help">10秒以内に出してね（出さないと負け）</p>
        </section>

        <section class="reveal card">
          <div>あなた：<span id="meChoice">？</span></div>
          <div>相手　：<span id="opChoice">？</span></div>
          <div>結果　：<b id="resultText">-</b></div>
        </section>

        <div class="row">
          <button id="btnNext" class="hidden">次のラウンド</button>
          <button id="btnExit" class="warn">終了</button>
        </div>
      </section>

      <footer class="footer"><small>© 2025 RPS Cards — pastel & comfy 💗 1.0.0</small></footer>

      <!-- [B9] 手動ディスプレイ広告（ゲームの下 / 非固定） -->
      <section class="ad-card card">
        <ins class="adsbygoogle"
             style="display:block"
             data-ad-client="ca-pub-3891016340964160"
             data-ad-slot="5935056834"
             data-ad-format="auto"
             data-full-width-responsive="true"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      </section>
    </main>
  </div>

  <!-- [B7] 横向き時のガード -->
  <div class="orientation-guard" id="orientationGuard">
    <div class="og-card">📱 画面を縦向きにしてください</div>
  </div>

  <!-- [B7.5] ヘルプモーダル -->
  <div id="helpModal" class="help-modal hidden" aria-hidden="true" role="dialog" aria-modal="true">
    <div class="help-modal__card">
      <div class="help-modal__head">
        <h3>あそびかた</h3>
        <button id="helpClose" class="help-close" aria-label="閉じる">×</button>
      </div>
      <div class="help-modal__body">
        <ol>
          <li>各ラウンド10秒でカードを1枚提出。相手も同時に出すよ。</li>
          <li>通常手：<b>✊グー(+3)</b> / <b>✌️チョキ(+4)</b> / <b>🫲パー(+5)</b>。勝った方がその数だけ進む。</li>
          <li><b>👑必勝</b>：なんにでも勝って +4（ただし <b>🛡️バリア</b> には負け）</li>
          <li><b>🔁位置交換</b>：差が <b>8未満</b> なら位置を入れ替え（<b>🛡️バリア</b> に負け）</li>
          <li><b>🛡️バリア</b>：相手の必勝/位置交換を防ぐ。通常手相手だと自分に<b>-1</b>ペナルティ</li>
          <li>両者未提出は時間切れ。表示に従って進行。</li>
          <li>最低8R後、よりゴールに近い方が勝ち！再戦も選べるよ。</li>
        </ol>
        <p class="hint">※ 仲良く遊んでね！</p>
      </div>
      <div class="help-modal__foot">
        <button class="primary" id="helpOk">OK</button>
      </div>
    </div>
  </div>

  <!-- [B8] アプリ本体 -->
  <script type="module" src="app.js"></script>

  <!-- [B9] ヘルプ開閉（app.js とは独立） -->
  <script>
    const $ = s => document.querySelector(s);
    const helpBtn = $('#helpBtn'), helpModal = $('#helpModal');
    const helpClose = $('#helpClose'), helpOk = $('#helpOk');

    const openHelp = () => { helpModal.classList.remove('hidden'); helpModal.setAttribute('aria-hidden','false'); };
    const closeHelp = () => { helpModal.classList.add('hidden'); helpModal.setAttribute('aria-hidden','true'); };

    helpBtn?.addEventListener('click', openHelp);
    helpClose?.addEventListener('click', closeHelp);
    helpOk?.addEventListener('click', closeHelp);
    helpModal?.addEventListener('click', (e)=>{ if(e.target===helpModal) closeHelp(); });
    // 初回はヘルプを軽く案内（必要ならコメントアウト）
    // window.addEventListener('load', ()=> setTimeout(openHelp, 600));
  </script>

  <!-- [B10] Service Worker -->
  <script>
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('./service-worker.js');
      });
    }
  </script>
</body>
</html>
